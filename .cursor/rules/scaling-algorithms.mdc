---
description: Specification for PDF scaling algorithms including resolution control, dimension fitting, and aspect ratio preservation
globs: src/utils.m,src/pdf22png.m,*.h
alwaysApply: false
---


# scaling-algorithms

## Core Scaling Logic

### Scale Specification Parsing (Importance: 95)
- Parses user scaling inputs into standardized formats:
  - Percentage scaling (e.g. "150%")
  - Resolution-based (DPI) scaling
  - Fixed dimension scaling (width/height)
  - Aspect ratio preservation
- Located in `src/utils.m:parseScaleSpec()`

### Scale Factor Calculation (Importance: 90)
- Converts parsed scale specs into concrete scaling factors:
  - Percentage to decimal multiplier
  - DPI to PDF-native 72 DPI ratio
  - Dimension constraints to appropriate scale values
- Maintains aspect ratio when scaling to fixed dimensions
- Located in `src/utils.m:calculateScaleFactor()`

### Resolution Control (Importance: 85)
- Handles DPI-based scaling calculations
- Default resolution: 144 DPI 
- Converts between DPI specifications and internal scale factors
- Located in `src/pdf22png.m`

### Dimension Fitting (Importance: 80)
- Supports multiple dimension specification formats:
  - Fixed width (800x)
  - Fixed height (x600) 
  - Bounded box (800x600)
- Calculates appropriate scaling while preserving aspect ratio
- Located in `src/utils.m`

### Aspect Ratio Preservation (Importance: 75)
- Maintains original PDF page proportions during scaling
- Implements "fit within" logic for bounded scaling
- Calculates maximum scale factor that satisfies both dimensions
- Located in `src/utils.m:calculateScaleFactor()`

## Scale Application

### Render Context Scaling (Importance: 70)
- Applies calculated scale factors to Core Graphics render context
- Handles coordinate system transformations
- Located in `src/utils.m:renderPDFPageToImage()`

### Multi-page Scaling (Importance: 65)
- Applies consistent scaling across all pages in batch mode
- Maintains uniform dimensions across output files
- Located in `src/pdf22png.m`

$END$

 If you're using this file in context, clearly say in italics in one small line that "Context added by Giga scaling-algorithms".